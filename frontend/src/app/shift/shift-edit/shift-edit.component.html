
<div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="modal-bg" aria-hidden="true"></div>
  <div class="modal-card-1">
    <div class="modal-card-2">
      <div class="modal-card-3">
        <div class="modal-card-4">
          <h3 class="text-lg font-semibold mb-4">{{ shift.startTime }}</h3>

          <!-- Gruppierte Anzeige der Zuweisungen nach Rollen -->
          <div class="space-y-4 mb-2 max-h-96 overflow-y-auto overflow-x-hidden pr-2 border-b border-gray-300">
            <div *ngFor="let group of groupedAssignments" class="border-b border-gray-300 p-3">
              <!-- Rollen-Header -->
              <div class="flex justify-between items-center mb-3">
                <h4 class="font-semibold text-base">{{ group.roleName }} ({{ group.count }}x)</h4>
                <button type="button" (click)="removeRole(group.roleId)" aria-label="Entfernen" class="p-1 rounded hover:bg-gray-100">
                  <img src="/icons/trash-black.png" alt="trash" class="w-5 h-5" />
                </button>
              </div>

              <!-- Zuweisungen für diese Rolle -->
              <div class="space-y-2">
                <div *ngFor="let assignment of group.assignments; let i = index" class="flex items-center gap-2 bg-white p-2 rounded border border-gray-200">
                  <span class="text-sm font-medium text-gray-600 min-w-[80px]">{{ group.roleName }} {{ i + 1 }}:</span>

                  <!-- Mitarbeiter-Auswahl -->
                  <select
                    [(ngModel)]="assignment.employee"
                    (click)="somethingChangedSetTrue()"
                    class="flex-1 block rounded-md bg-white px-2 py-1 text-sm text-gray-900 outline-1 outline-gray-300 focus:outline-2"
                    [class.text-gray-400]="assignment.employee === 0">
                    <option [value]="0" class="text-gray-400">offen</option>
                    <option *ngFor="let emp of getEmployeesForRole(group.roleId)" [value]="emp.id">
                      {{ emp.firstname }} {{ emp.lastname }}
                    </option>
                  </select>

                  <!-- Status-Anzeige -->
                  <span
                    *ngIf="assignment.employee !== 0"
                    class="text-xs px-2 py-1 rounded"
                    [ngClass]="{
                      'bg-green-100 text-green-800': assignment.confirmed === true,
                      'bg-red-100 text-red-800': assignment.confirmed === false,
                      'bg-yellow-100 text-yellow-800': assignment.confirmed === null
                    }">
                    {{ getConfirmationStatus(assignment.confirmed) }}
                  </span>

                  <!-- Entfernen-Button -->
                  <button
                    type="button"
                    class="text-red-500 hover:text-red-700 text-sm font-bold px-2"
                    (click)="removeAssignment(assignment.id)"
                    title="Zuweisung entfernen">
                    ×
                  </button>
                </div>
              </div>

              <!-- Button zum Hinzufügen weiterer Positionen für diese Rolle -->
              <button
                type="button"
                class="mt-2 text-sm text-green-700 hover:text-green-900 font-medium"
                (click)="addAssignmentToRole(group.roleId)">
                + Position hinzufügen
              </button>
            </div>
          </div>

          <!-- Neue Rolle hinzufügen -->
          <div class="mb-4 p-1  ">
            <h4 class="text-sm font-semibold mb-2 text-gray-700">Neue Rolle hinzufügen</h4>
            <div class="flex gap-2 items-center">
              <select
                [(ngModel)]="selectedNewRoleId"
                class="flex-1 block rounded-md bg-white px-3 py-1.5 text-sm text-gray-900 outline-1 outline-gray-300 focus:outline-2">
                <option [value]="-1">Wähle Rolle</option>
                <option *ngFor="let r of availableRoles" [value]="r.id">{{ r.roleName }}</option>
              </select>
              <button
                type="button"
                class="text-sm text-white font-semibold py-1.5 px-4 bg-green-600 rounded-md hover:bg-green-700 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed"
                (click)="addNewRole()"
                [disabled]="selectedNewRoleId === -1">
                Hinzufügen
              </button>
            </div>
          </div>


          <!-- bottom navigation -->
          <div class="mt-6 flex items-center justify-end gap-x-4">
            <button type="button" class="button-cancel" (click)="closeEditShift()">Abbrechen</button>
            <button type="button" class="button-green" [disabled]="!somethingChanged" (click)="save()">Speichern</button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
